#!/bin/sh

if [ -z "$1" ]; then
   echo "Usage: `basename $0` <Target> [Group ID]"
else
   if [ -z "$2" ]; then
      GroupID=$2
   else
      GroupID='test'
   fi
   # Encryption algorithms: DES, 3DES, AES/128, AES/192, AES/256, IDEA, Blowfish, RC5, CAST, Camellia
   ENCLIST="1 5 7/128 7/192 7/256 2 3 4 6 8"
   # Hash algorithms: MD5, SHA1, Tiger, SHA-256, SHA-384, SHA-512
   HASHLIST="1 2 3 4 5 6"
   # Authentication methods: PSK, XAUTH, DSS Sig, RSA Sig, RSA Enc, Revised RSA Enc, ElGamel Enc, Revised ElGamel Enc, ECDSA Sig, and Hybrid Mode
   AUTHLIST="1 65001 2 3 4 5 6 7 8 64221"
   # Diffie-Hellman groups: MODP 768, MODP 1024, MODP 1536, EC2N 155, EC2N 185, EC2N 163, EC2N 163, EC2N 183, EC2N 183, EC2N 409, EC2N 409, EC2N 571, EC2N 571, MODP 2048, MODP 3072, MODP 4096, MODP 6144, MODP 8192
   GROUPLIST="1 2 5 3 4 6 7 8 9 10 11 12 13 14 15 16 17 18"
   #
   for ENC in $AUTHLIST; do
      for HASH in $GROUPLIST; do
         for AUTH in $ENCLIST; do
            for GROUP in $HASHLIST; do
               ikenormalresult=`ike-scan --trans=$ENC,$HASH,$AUTH,$GROUP $1`
               normalhandshakefound=`echo $ikenormalresult | grep "1 returned handshake"`
               if [ "$normalhandshakefound" ]; then
                  echo "\n[*] Handshake found:"
                  echo "[*] ike-scan --trans=$ENC,$HASH,$AUTH,$GROUP $1"
                  echo "[*] Testing for agressive mode..."
                  ikeagressiveresult=`ike-scan -A -id=$GroupID --trans=$ENC,$HASH,$AUTH,$GROUP $1`
                  agressivehandshakefound=`echo $ikeagressiveresult | grep "1 returned handshake"`
                  if [ "$agressivehandshakefound" ]; then
                     echo "[!] Agressive mode handshake found..."
                     echo "[*] ike-scan -A -P -v -id=$GroupID --trans=$ENC,$HASH,$AUTH,$GROUP $1"
                     ikecipher=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Enc=" | awk -F "(" {'print $2'}`
                     ikehash=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Hash="`
                     ikekeylength=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "KeyLength="`
                     ikemodulus=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Group="`
                     ikeauth=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Auth="`
                     echo "[*] "$ikecipher" "$ikehash" "$ikekeylength" "$ikemodulus" "$ikeauth
                  fi
               fi
            done
         done
      done
   done
fi
