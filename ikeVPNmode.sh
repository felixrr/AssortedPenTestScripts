#!/bin/sh

if [ -z "$1" ]; then
   echo "Usage: `basename $0` <Target>"
else
   # Encryption algorithms: DES, Triple-DES, AES/128, AES/192 and AES/256
   ENCLIST="1 5 7/128 7/192 7/256"
   # Hash algorithms: MD5 and SHA1
   HASHLIST="1 2"
   # Authentication methods: Pre-Shared Key, RSA Signatures, Hybrid Mode and XAUTH
   AUTHLIST="1 3 64221 65001"
   # Diffie-Hellman groups: 1, 2 and 5
   GROUPLIST="1 2 5"
   #
   for ENC in $ENCLIST; do
      for HASH in $HASHLIST; do
         for AUTH in $AUTHLIST; do
            for GROUP in $GROUPLIST; do
               ikenormalresult=`ike-scan --trans=$ENC,$HASH,$AUTH,$GROUP $1`
               normalhandshakefound=`echo $ikenormalresult | grep "1 returned handshake"`
               if [ "$normalhandshakefound" ]; then
                  echo "\n[*] Handshake found:"
                  echo "[*] ike-scan --trans=$ENC,$HASH,$AUTH,$GROUP $1"
                  echo "[*] Testing for agressive mode..."
                  ikeagressiveresult=`ike-scan -A -id=test --trans=$ENC,$HASH,$AUTH,$GROUP $1`
                  agressivehandshakefound=`echo $ikeagressiveresult | grep "1 returned handshake"`
                  if [ "$agressivehandshakefound" ]; then
                     echo "[!] Agressive mode handshake found..."
                     echo "[*] ike-scan -A -P -v -id=test --trans=$ENC,$HASH,$AUTH,$GROUP $1"
                     ikecipher=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Enc=" | awk -F "(" {'print $2'}`
                     ikehash=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Hash="`
                     ikekeylength=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "KeyLength="`
                     ikemodulus=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Group="`
                     ikeauth=`echo $ikeagressiveresult | sed "s/ /\n/g" | grep "Auth="`
                     echo "[*] "$ikecipher" "$ikehash" "$ikekeylength" "$ikemodulus" "$ikeauth
                  fi
               fi
            done
         done
      done
   done
fi
